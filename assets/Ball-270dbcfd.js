import{r as c,j as z,a as O}from"./index-ed560b02.js";import{B as N,V as B,M as I,F as R,b as q,c as P,T as S,d as U,e as J,E as _,f as G,O as K,_ as Q,u as Y,g as v,C as V}from"./react-three-fiber.esm-db0b74cc.js";import{L as tt,O as et}from"./Loader-af4babf2.js";import{P as ot}from"./Preload-9878cb73.js";class rt extends N{constructor(m,y,f,T){super();const u=[],g=[],E=[],l=new B,M=new I;M.makeRotationFromEuler(f),M.setPosition(y);const k=new I;k.copy(M).invert(),j(),this.setAttribute("position",new R(u,3)),this.setAttribute("normal",new R(g,3)),this.setAttribute("uv",new R(E,2));function j(){let t,e=[];const o=new B,s=new B;if(m.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const n=m.geometry,A=n.attributes.position,x=n.attributes.normal;if(n.index!==null){const p=n.index;for(t=0;t<p.count;t++)o.fromBufferAttribute(A,p.getX(t)),s.fromBufferAttribute(x,p.getX(t)),w(e,o,s)}else for(t=0;t<A.count;t++)o.fromBufferAttribute(A,t),s.fromBufferAttribute(x,t),w(e,o,s);for(e=h(e,l.set(1,0,0)),e=h(e,l.set(-1,0,0)),e=h(e,l.set(0,1,0)),e=h(e,l.set(0,-1,0)),e=h(e,l.set(0,0,1)),e=h(e,l.set(0,0,-1)),t=0;t<e.length;t++){const p=e[t];E.push(.5+p.position.x/T.x,.5+p.position.y/T.y),p.position.applyMatrix4(M),u.push(p.position.x,p.position.y,p.position.z),g.push(p.normal.x,p.normal.y,p.normal.z)}}function w(t,e,o){e.applyMatrix4(m.matrixWorld),e.applyMatrix4(k),o.transformDirection(m.matrixWorld),t.push(new C(e.clone(),o.clone()))}function h(t,e){const o=[],s=.5*Math.abs(T.dot(e));for(let n=0;n<t.length;n+=3){let A,x,p,H=0,i,d,b,D;const X=t[n+0].position.dot(e)-s,Z=t[n+1].position.dot(e)-s,$=t[n+2].position.dot(e)-s;switch(A=X>0,x=Z>0,p=$>0,H=(A?1:0)+(x?1:0)+(p?1:0),H){case 0:{o.push(t[n]),o.push(t[n+1]),o.push(t[n+2]);break}case 1:{if(A&&(i=t[n+1],d=t[n+2],b=a(t[n],i,e,s),D=a(t[n],d,e,s)),x){i=t[n],d=t[n+2],b=a(t[n+1],i,e,s),D=a(t[n+1],d,e,s),o.push(b),o.push(d.clone()),o.push(i.clone()),o.push(d.clone()),o.push(b.clone()),o.push(D);break}p&&(i=t[n],d=t[n+1],b=a(t[n+2],i,e,s),D=a(t[n+2],d,e,s)),o.push(i.clone()),o.push(d.clone()),o.push(b),o.push(D),o.push(b.clone()),o.push(d.clone());break}case 2:{A||(i=t[n].clone(),d=a(i,t[n+1],e,s),b=a(i,t[n+2],e,s),o.push(i),o.push(d),o.push(b)),x||(i=t[n+1].clone(),d=a(i,t[n+2],e,s),b=a(i,t[n],e,s),o.push(i),o.push(d),o.push(b)),p||(i=t[n+2].clone(),d=a(i,t[n],e,s),b=a(i,t[n+1],e,s),o.push(i),o.push(d),o.push(b));break}}}return o}function a(t,e,o,s){const n=t.position.dot(o)-s,A=e.position.dot(o)-s,x=n/(n-A);return new C(new B(t.position.x+x*(e.position.x-t.position.x),t.position.y+x*(e.position.y-t.position.y),t.position.z+x*(e.position.z-t.position.z)),new B(t.normal.x+x*(e.normal.x-t.normal.x),t.normal.y+x*(e.normal.y-t.normal.y),t.normal.z+x*(e.normal.z-t.normal.z)))}}}class C{constructor(m,y){this.position=m,this.normal=y}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}const F=r=>r===Object(r)&&!Array.isArray(r)&&typeof r!="function";function W(r,m){const y=q(u=>u.gl),f=P(S,F(r)?Object.values(r):r);return c.useLayoutEffect(()=>{m==null||m(f)},[m]),c.useEffect(()=>{if("initTexture"in y){let u=[];Array.isArray(f)?u=f:f instanceof U?u=[f]:F(f)&&(u=Object.values(f)),u.forEach(g=>{g instanceof U&&y.initTexture(g)})}},[y,f]),c.useMemo(()=>{if(F(r)){const u={};let g=0;for(const E in r)u[E]=f[g++];return u}else return f},[r,f])}W.preload=r=>P.preload(S,r);W.clear=r=>P.clear(S,r);function nt(r){return Array.isArray(r)}function L(r=[0,0,0]){return nt(r)?r:r instanceof B||r instanceof _?[r.x,r.y,r.z]:[r,r,r]}const st=c.forwardRef(function({debug:m,depthTest:y=!1,polygonOffsetFactor:f=-10,map:T,mesh:u,children:g,position:E,rotation:l,scale:M,...k},j){const w=c.useRef(null);c.useImperativeHandle(j,()=>w.current);const h=c.useRef(null);return c.useLayoutEffect(()=>{const a=(u==null?void 0:u.current)||w.current.parent,t=w.current;if(!(a instanceof J))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const e={position:new B,rotation:new _,scale:new B(1,1,1)};if(a){G(e,{position:E,scale:M});const o=a.matrixWorld.clone();if(a.matrixWorld.identity(),!l||typeof l=="number"){const s=new K;s.position.copy(e.position),s.lookAt(a.position),typeof l=="number"&&s.rotateZ(l),G(e,{rotation:s.rotation})}else G(e,{rotation:l});return t.geometry=new rt(a,e.position,e.rotation,e.scale),h.current&&(G(h.current,e),h.current.traverse(s=>s.raycast=()=>null)),a.matrixWorld=o,()=>{t.geometry.dispose()}}},[u,...L(E),...L(M),...L(l)]),c.createElement("mesh",Q({ref:w,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":f,"material-depthTest":y,"material-map":T},k),g,m&&c.createElement("mesh",{ref:h},c.createElement("boxGeometry",null),c.createElement("meshNormalMaterial",{wireframe:!0}),c.createElement("axesHelper",null)))}),at=c.forwardRef(({children:r,enabled:m=!0,speed:y=1,rotationIntensity:f=1,floatIntensity:T=1,floatingRange:u=[-.1,.1],...g},E)=>{const l=c.useRef(null);c.useImperativeHandle(E,()=>l.current,[]);const M=c.useRef(Math.random()*1e4);return Y(k=>{var j,w;if(!m||y===0)return;const h=M.current+k.clock.getElapsedTime();l.current.rotation.x=Math.cos(h/4*y)/8*f,l.current.rotation.y=Math.sin(h/4*y)/8*f,l.current.rotation.z=Math.sin(h/4*y)/20*f;let a=Math.sin(h/4*y)/10;a=v.mapLinear(a,-.1,.1,(j=u==null?void 0:u[0])!==null&&j!==void 0?j:-.1,(w=u==null?void 0:u[1])!==null&&w!==void 0?w:.1),l.current.position.y=a*T,l.current.updateMatrix()}),c.createElement("group",g,c.createElement("group",{ref:l,matrixAutoUpdate:!1},r))}),ut=r=>{const[m]=W([r.imgUrl]);return z(at,{speed:2,rotationIntensity:1,floatIntensity:2.5,children:[O("ambientLight",{intensity:.25}),O("directionalLight",{position:[0,0,.05]}),z("mesh",{castShadow:!0,receiveShadow:!0,scale:2.75,children:[O("icosahedronGeometry",{args:[1,1]}),O("meshStandardMaterial",{color:"#fff8eb",polygonOffset:!0,polygonOffsetFactor:-5,flatShading:!0}),O(st,{postion:[0,0,1],rotation:[2*Math.PI,0,6.25],flatShading:!0,map:m})]})]})},pt=({icon:r})=>z(V,{frameloop:"demand",gl:{preserveDrawingBuffer:!0},children:[z(c.Suspense,{fallback:O(tt,{}),children:[O(et,{enableZoom:!1}),O(ut,{imgUrl:r})]}),O(ot,{all:!0})]});export{pt as default};
